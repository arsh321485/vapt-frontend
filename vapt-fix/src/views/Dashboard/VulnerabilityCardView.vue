<template>
    <main>
        <section>
            <div class="container-fluid px-0">
                <div class="row gx-0 no-gutters">
                    <DashboardHeader />
                </div>
                <div class="row">
                    <div class="col-1 ps-0 menubar-col1">
                        <DashboardMenu />
                    </div>

                    <div class="col-11 pt-2 pb-3 pe-5 ps-4">
                        <div class="d-flex justify-content-between">
                            <div><p class="mt-5" style="color: rgba(0, 0, 0, 0.6);font-weight: 500;font-size: 15px;">Vulnerability card</p></div>
                            <div class="dropdown mt-5">
                                <div class="dropdown-btn"> Select location</div>
                                <div class="dropdown-content">
                                    <a href="#">Greece</a>
                                    <a href="#">Germany</a>
                                    <a href="#">Bahrain</a>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="d-flex justify-content-start gap-3">
                                <div class="d-flex justify-content-start gap-3">
                                <div class="fw-semibold" style="color: rgba(0, 0, 0, 0.87);">
                                <h2 style="font-size: 44px;">192.168.1.42</h2>    
                                </div>
                                <span class="d-flex align-items-center badge-critical mt-3">
                                    <span class="rounded-circle me-1"
                                        style="width: 6px; height: 6px; background-color: rgba(173, 0, 0, 1)"></span>
                                    <span>Critical</span>
                                </span>
                                <span class="d-flex align-items-center badge-open mt-3">
                                    <span class="rounded-circle me-1"
                                        style="width: 6px; height: 6px; background-color: rgba(49, 33, 177, 1)"></span>
                                    <span>Open</span>
                                </span>
                                </div>
                                <div class="mt-3">
                                    <router-link to="" class="btn btn-sm text-light" style="background-color: rgba(49, 33, 177, 1);">Exception Requests</router-link>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-9">
                                <p class="mt-2 mb-1" style="color: rgba(0, 0, 0, 0.6);font-weight: 500;font-size: 14px;">Risk name</p>
                                <p class="mt-0 pt-0" style="color: rgba(0, 0, 0, 0.87);font-size: 15px;font-weight: 500;">VMware ESXi 7.0/8.0 Sandbox Escape (CVE - 2025-22225)</p>

                                <div class="row">
                                    <div class="">
                                        <button class="btn mt-3 mb-1 text-light" style="background-color: rgba(49, 33, 177, 1);font-weight: 500;font-size: 14px;" @click="toggleRow">Related </button>
                                        <!-- <p>resource_id</p>
                                        <p>region</p>
                                        <p>affected_packages</p>
                                        <p>vendor_advisory</p> -->
                                    </div> 
                                </div>

                                <div class="row" v-if="showFirstRow">
                                    <div class="row">
                                    <div class="col-6">   
                                        <p class="mt-3 mb-1" style="color: rgba(0, 0, 0, 0.6);font-weight: 500;font-size: 14px;">Finding</p>
                                        <p class="mt-0 pt-0" style="color: rgba(0, 0, 0, 0.87);font-size: 15px;font-weight: 500;">The remote VMware ESXi host is affected by a sandbox escape vulnerability.</p>
                                    </div>
                                    <div class="col-6">
                                        <p class="mt-3 mb-1" style="color: rgba(0, 0, 0, 0.6);font-weight: 500;font-size: 14px;">Description</p>
                                        <p class="mt-0 pt-0" style="color: rgba(0, 0, 0, 0.87);font-size: 15px;font-weight: 500;">The remote VMware ESXi host is affected by a sandbox escape vulnerability.</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                        <p class="mt-3 mb-1" style="color: rgba(0, 0, 0, 0.6);font-weight: 500;font-size: 14px;">Vulnerability Type</p>
                                            <p class="mt-0 pt-0" style="color: rgba(0, 0, 0, 0.87);font-size: 15px;font-weight: 500;">SQL Injection, Cross site scripting, Buffer overflow</p>
                                        </div>
                                        <div class="col-6">
                                            <p class="mt-3 mb-1" style="color: rgba(0, 0, 0, 0.6);font-weight: 500;font-size: 14px;">Affected Port</p>
                                            <p class="mt-0 pt-0" style="color: rgba(0, 0, 0, 0.87);font-size: 15px;font-weight: 500;">443</p>
                                        </div>
                                    
                                    </div>
                                </div>
                            
                                <!-- Alternate Row -->
    <div v-else class="row">
      <div class="col">
        <!-- <h5>Related</h5> -->
        <ul class="mt-2">
            <li>resource_id</li>
            <li>region</li>
            <li>affected_packages</li>
            <li>vendor_advisory</li>
        </ul>
      </div>
    </div>

                                <div class="row mt-5 pe-5">
                                    <h5 style="color: rgba(49, 33, 177, 1);font-size: 24px;font-weight: 600;">Steps to fix (6)</h5>
                                    <div class="card p-4" style="border-radius: 24px;">
                                    <div class="stepper-card d-flex justify-content-between align-items-start w-100">
                                        <!-- Step 1 -->
                                        <div class="step text-center active-step">
                                        <div class="step-title">Step 1</div>
                                        <div class="step-label fw-semibold text-primary">Code review</div>
                                        <div class="step-dot mt-1"></div>
                                        </div>
                                    <div class="flex-grow-1 border-top mx-2 my-auto"></div>
                                        <!-- Step 2 to 6 -->
                                        <div class="step text-center">
                                        <div class="step-title text-muted">Step 2</div>
                                        <div class="step-label text-muted">Code review</div>
                                        </div>
                                        <div class="flex-grow-1 border-top mx-2 my-auto"></div>

                                        <div class="step text-center">
                                        <div class="step-title text-muted">Step 3</div>
                                        <div class="step-label text-muted">Code review</div>
                                        </div>
                                        <div class="flex-grow-1 border-top mx-2 my-auto"></div>
                                        
                                        <div class="step text-center">
                                        <div class="step-title text-muted">Step 4</div>
                                        <div class="step-label text-muted">Code review</div>
                                        </div>
                                        <div class="flex-grow-1 border-top mx-2 my-auto"></div>

                                        <div class="step text-center">
                                        <div class="step-title text-muted">Step 5</div>
                                        <div class="step-label text-muted">Code review</div>
                                        </div>
                                        <div class="flex-grow-1 border-top mx-2 my-auto"></div>

                                        <div class="step text-center">
                                        <div class="step-title text-muted">Step 6</div>
                                        <div class="step-label text-muted">Code review</div>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-start my-4 gap-4">
                                        <div class="d-flex flex-row gap-2">
                                            <span style="color: rgba(0, 0, 0, 0.6);font-size: 13px;">Assigned to:</span>
                                            <!-- <span> -->
                                                <span class="avatar-container" style="margin-top: -10px;">
                                                <span class="avatar ava-green">GM</span>
                                                <span class="avatar ava-blue">UK</span>
                                                <span class="avatar ava-yellow">BH</span>
                                                <div class="avatar ava-black">+3</div>
                                            </span>
                                            <!-- </span> -->
                                        </div>
                                        <div>
                                            <span style="color: rgba(0, 0, 0, 0.6);font-size: 13px;">Set deadline:</span>
                                            <span style="color: rgba(0, 0, 0, 0.87);font-size: 14px;"> 24th July, 2025</span>
                                            <span style="color: rgba(49, 33, 177, 1);font-size: 15px;font-weight: 600;"> Edit</span>
                                        </div>
                                        <div>
                                            <span style="color: rgba(0, 0, 0, 0.6);font-size: 13px;">Artifacts/Tools used:</span>
                                            <span style="color: rgba(0, 0, 0, 0.87);font-size: 14px;"> Source code</span>
                                            <span style="color: rgba(49, 33, 177, 1);font-size: 15px;margin-top: -5px;font-weight: 600"> <i class="bi bi-info-circle ms-1"></i></span>
                                        </div>
                                    </div>
                                    <p class="mt-3 mb-2" style="color: rgba(0, 0, 0, 0.87);font-size: 16px;font-weight: 500;">Identify all points where user input if reflected back to the user or included in redirects. Identify all points where user input if reflected back to the user or included in redirects.</p>
                                    <div class="p-4 mb-5" style="background-color: rgba(246, 246, 246, 1);">
                                        <div class="mb-3" style="color: rgba(0, 0, 0, 0.6);font-size: 14px;">System file path: <span style="color: rgba(0, 0, 0, 0.87);">C:\inetpub\wwwroot\</span></div>
                                        <p style="color: rgba(0, 0, 0, 0.87);font-size: 15px;font-weight: 500;">Review all .aspx and .cs files for instances of “Response.Redirect”, “Server.Transfer” and output statements like “Response.Write”.</p>
                                    </div>

                                    <div class="d-flex justify-content-end"><button class="btn text-light" style="background-color: rgba(49, 33, 177, 1);">Step Done</button></div>

                                    </div>
                                </div>

                               
                                
                            </div>
                            <div class="col-3">
                                <p class="mt-2" style="color: rgba(0, 0, 0, 0.6);font-weight: 500;font-size: 15px;">Timeline</p>
                                <div class="timeline-wrapper">
                                <div class="timeline-step">
                                    <div class="timeline-icon">
                                    <i class="bi bi-caret-right-fill text-primary"></i>
                                    </div>
                                    <div class="timeline-content">
                                    <p class="fw-semibold mb-1" >Vulnerability identified</p>
                                    <p class="text-muted small">23rd July, 2025</p>
                                    </div>
                                </div>

                                <div class="timeline-step">
                                    <div class="timeline-icon">
                                    <i class="bi bi-caret-right-fill text-primary"></i>
                                    </div>
                                    <div class="timeline-content">
                                    <p class="fw-semibold mb-1">Assigned to Team</p>
                                    <p class="text-muted small">23rd July, 2025</p>
                                    </div>
                                </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</template>

<script>
import DashboardMenu from "@/components/DashboardMenu.vue";
import DashboardHeader from "@/components/DashboardHeader.vue";

export default {
    name: "Vulnerability Card",
    components: {
        DashboardMenu,
        DashboardHeader,
    },
     data() {
    return {
      showFirstRow: true, // default content
    };
  },
   methods: {
    toggleRow() {
      this.showFirstRow = !this.showFirstRow;
    },
  },
    mounted() {
    const dropdown = document.querySelector('.dropdown');
    const btn = dropdown.querySelector('.dropdown-btn');
    const options = dropdown.querySelectorAll('.dropdown-content a');

    // Toggle dropdown open/close
    btn.addEventListener('click', () => {
      dropdown.classList.toggle('show');
    });

    // Set selected option
    options.forEach(option => {
      option.addEventListener('click', (e) => {
        e.preventDefault();
        btn.textContent = option.textContent; // update button text
        dropdown.classList.remove('show'); // close dropdown
      });
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!dropdown.contains(e.target)) {
        dropdown.classList.remove('show');
      }
    });
},
};
</script>

<style scoped>

  .badge-critical {
    background-color: rgba(255, 225, 225, 1);
    color: rgba(173, 0, 0, 1);
    font-weight: 600;
    font-size: 0.75rem;
    padding: 4px 8px;
    border-radius: 8px;
    height: 30px;
  }

  .badge-open {
    background-color: rgba(230, 227, 255, 1);
    color: rgba(49, 33, 177, 1);
    font-weight: 600;
    font-size: 0.75rem;
    padding: 4px 8px;
    border-radius: 8px;
    height: 30px;
  }

  .stepper-card {
  position: relative;
  padding-top: 5px;
}

.step {
  position: relative;
  z-index: 1;
  flex: 1;
}

.step-title {
  font-size: 12px;
  color: rgba(0, 0, 0, 0.6);
  font-size: 13px;
  font-weight: 500;
}

.step-label {
  font-size: 15px;
  color: rgba(0, 140, 156, 1);
  font-weight: 500;  
}

.step-dot {
  width: 6px;
  height: 6px;
  background-color: rgba(49, 33, 177, 1);
  border-radius: 50%;
  margin: 0 auto;
}

.active-step .step-title {
  color: #000;
}

.active-step .step-label {
  color: #007b8f;
  font-weight: 600;
}


.timeline-wrapper {
  position: relative;
  padding-left: 30px;
  border-left: 1px solid #e0e0e0;
  height:930px;
}

.timeline-title {
  font-weight: 500;
  font-size: 15px;
  color: rgba(0, 0, 0, 1);
  margin-bottom: 1rem;
}

.timeline-step {
  position: relative;
  display: flex;
  align-items: flex-start;
  margin-bottom: 30px;
}

.timeline-icon {
  position: absolute;
  left:-40px;
  top: 0;
  background-color: rgba(255, 255, 255, 1);
  border-radius: 50%;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 2px 8px 12px rgba(0, 0, 0, 0.12); 
}

.timeline-icon img {
  width: 10px;
  height: 10px;
}

.timeline-content {
  padding-left: 20px;
}

.dropdown {
    position: relative;
    display: inline-block;
    width: 200px;
}

.dropdown-btn {
    background-color: white;
    border: 1px solid rgba(0, 0, 0, 0.16);
    border-radius: 50px;
    padding: 4px 20px 4px 12px; /* extra right padding for the arrow */
    cursor: pointer;
    position: relative;
}

.dropdown-btn::after {
    content: "▼"; /* arrow symbol */
    font-size: 12px;
    color: #333;
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 100%;
    border-radius: 12px;
    box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
    z-index: 1;
    margin-top: 4px;
}

.dropdown-content a {
    padding: 8px 12px;
    display: block;
    text-decoration: none;
    color: black;
    border-radius: 8px;
}

.dropdown-content a:hover {
    background-color: #f1f1f1;
}

.dropdown.show .dropdown-content {
    display: block;
}

</style>